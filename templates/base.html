<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}SmartKids{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    {% block head_extra %}{% endblock %}
</head>

<body>
<div class="app-container">
    <aside class="sidebar" id="sidebar">
        <div class="logo-area">
            <div class="logo-container">
                <div class="logo-circle">
                    <img src="https://smk.bkt.net.vn/_next/image?url=%2Fbkt_logo.png&w=384&q=75" alt="Logo BKT">
                </div>
                <span class="role-badge" data-i18n="role_teacher">Gi√°o vi√™n</span>
            </div>
        </div>

        <div class="toggle-btn" id="sidebarToggle">
            <i class="fas fa-chevron-left"></i>
        </div>

        <div class="user-profile">
            <div class="avatar-wrapper">
                <img src="https://smk.bkt.net.vn/_next/image?url=https%3A%2F%2Fstatic.edupia.vn%2Fimages%2Favata_system%2F55.png&w=256&q=75"
                     alt="User Avatar" class="avatar">
                <div class="edit-icon"><i class="fas fa-pencil-alt"></i></div>
            </div>
            <div class="user-email">{{ user_email }}</div>
        </div>

        <div class="festive-decoration">
            <div class="decoration-line">
                <i class="fas fa-holly-berry" style="color: #e74c3c;"></i>
                <i class="fas fa-dragon" style="color: #f1c40f; font-size: 24px;"></i>
                <i class="fas fa-holly-berry" style="color: #e74c3c;"></i>
            </div>
        </div>

        <nav class="nav-menu">
            <div class="menu-list">
                <div class="menu-item {% block overview_active %}{% endblock %}">
                    <a href="#" class="menu-link">
                        <div class="icon-box"><i class="fas fa-th-large"></i></div>
                        <span class="nav-text" data-i18n="overview">T·ªïng quan</span>
                    </a>
                </div>

                <div class="menu-item has-dropdown">
                    <div class="menu-link" onclick="toggleDropdown(this)">
                        <div class="icon-box"><i class="fas fa-chalkboard-teacher"></i></div>
                        <span class="nav-text" data-i18n="class">L·ªõp h·ªçc</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </div>
                    <div class="submenu">
                        <a href="#" data-i18n="class_3_4">L·ªõp 3-4 tu·ªïi</a>
                        <a href="#" data-i18n="class_4_5">L·ªõp 4-5 tu·ªïi</a>
                        <a href="#" data-i18n="class_5_6">L·ªõp 5-6 tu·ªïi</a>
                    </div>
                </div>

                <div class="menu-item has-dropdown">
                    <div class="menu-link" onclick="toggleDropdown(this)">
                        <div class="icon-box"><i class="fas fa-chart-line"></i></div>
                        <span class="nav-text" data-i18n="teaching_progress">Ti·∫øn tr√¨nh gi·∫£ng d·∫°y</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </div>
                    <div class="submenu">
                        <a href="#" data-i18n="lesson_completed">B√†i ƒë√£ ho√†n th√†nh</a>
                        <a href="#" data-i18n="lessons_being_taught">B√†i ƒëang d·∫°y</a>
                    </div>
                </div>

                <div class="menu-item {% block set_mode_active %}{% endblock %}">
                    <a href="{{ url_for('set_teaching_mode') }}" class="menu-link">
                        <div class="icon-box"><i class="fas fa-sliders-h"></i></div>
                        <span class="nav-text" data-i18n="set_mode">C√†i ƒë·∫∑t ch·∫ø ƒë·ªô gi·∫£ng d·∫°y</span>
                    </a>
                </div>

                <div class="menu-item">
                    <a href="#" class="menu-link">
                        <div class="icon-box"><i class="fas fa-book"></i></div>
                        <span class="nav-text" data-i18n="material">T√†i li·ªáu tham kh·∫£o</span>
                    </a>
                </div>

                <div class="menu-item">
                    <a href="#" class="menu-link">
                        <div class="icon-box"><i class="fas fa-users"></i></div>
                        <span class="nav-text" data-i18n="expert_team">Team chuy√™n gia</span>
                    </a>
                </div>
            </div>
        </nav>

        <div class="mascot-area">
            <div class="notification-icon">
                <img src="https://smk.bkt.net.vn/_next/image?url=%2Fassets%2Fimage%2Fnotification.webp&w=640&q=85"
                     alt="Notification" class="notification-img">
            </div>

            <img src="https://smk.bkt.net.vn/_next/image?url=%2Fassets%2Fimage%2Fbkt_mascot.webp&w=640&q=85"
                 alt="Mascot" class="penguin-img">
        </div>
    </aside>
    <main class="main-content">
        <header class="top-header">
            <div class="banner-container">
                <div class="banner-text" data-i18n="smartkids_2025">SmartKids 2025</div>
            </div>
            <div class="header-controls">
                <div class="control-group">
                    <button class="btn-primary" onclick="window.location.href='{{ url_for('gioithieu') }}'">
                        <i class="fas fa-home"></i> Trang ch·ªß
                    </button>

                    <div class="lang-toggle">
                        <img src="https://flagcdn.com/w40/vn.png" alt="VN Flag" class="flag">
                        <span>Ti·∫øng Vi·ªát</span>
                        <div class="toggle-switch"></div>
                    </div>
                    <button class="btn-logout" data-i18n="theme">
                        <i class="fas fa-palette"></i> Ch·ªß ƒë·ªÅ
                    </button>
                </div>
                <div class="control-group bottom-row">
                    <div class="bkt-default">
                        <span class="badge">bkt</span> M·∫∑c ƒë·ªãnh
                    </div>
                    <a href="{{ url_for('logout') }}" class="btn-logout" data-i18n="logout">
                        <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
                    </a>
                </div>
            </div>
        </header>

        {% block main_content_block %}
        {% endblock %}

    </main>

    <div class="modal-backdrop" id="themeModalBackdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <span class="bkt-logo-text">bkt</span> SmartKid
                </h2>
                <button class="close-btn" id="closeThemeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <p class="modal-description">
                    Thay ƒë·ªïi m√†u n·ªÅn SmartKid <span class="mascot-icon">üëß</span>
                </p>

                <div class="theme-selector">
                    <div class="theme-options">
                        <div class="theme-option" data-color="yellow">
                            <i class="fas fa-star" style="color: #f1c40f;"></i>
                        </div>
                        <div class="theme-option selected" data-color="blue">
                            <i class="fas fa-star" style="color: #3498db;"></i>
                        </div>
                        <div class="theme-option" data-color="pink">
                            <i class="fas fa-star" style="color: #e74c3c;"></i>
                        </div>
                        <div class="theme-option" data-color="red">
                            <i class="fas fa-star" style="color: #c0392b;"></i>
                        </div>
                    </div>

                    <div class="festive-mascots">
                        <img src="https://static.edupia.vn/images/avata_system/55.png" alt="Mascot"
                             class="kid-mascot left">
                        <img src="https://static.edupia.vn/images/avata_system/55.png" alt="Mascot"
                             class="kid-mascot right">
                    </div>

                    <div class="color-preview-area">
                        <div class="color-preview-star" id="previewStar">
                            <i class="fas fa-star" style="color: #3498db;"></i>
                            <span class="tiger-deco left">üêÖ</span>
                            <span class="tiger-deco right">üêÖ</span>
                        </div>
                        <div class="color-input-display">
                            <div class="input-display-box" id="selectedColorDisplay"></div>
                        </div>
                        <button class="btn-change-theme" data-i18n="change_theme">Thay ƒë·ªïi</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script src="{{ url_for('static', filename='lang/lang_en.js') }}"></script>
<script src="{{ url_for('static', filename='lang/lang_vi.js') }}"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 1. L·∫•y c√°c ph·∫ßn t·ª≠
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');

        // 2. X·ª≠ l√Ω Sidebar Toggle
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');

            if (sidebar.classList.contains('collapsed')) {
                const openMenus = document.querySelectorAll('.menu-item.active');
                openMenus.forEach(item => item.classList.remove('active'));
            }
        });

        // 3. Dropdown Menu
        window.toggleDropdown = function(element) {
            if (sidebar.classList.contains('collapsed')) {
                sidebar.classList.remove('collapsed');
                setTimeout(() => {
                    element.parentElement.classList.toggle('active');
                }, 100);
            } else {
                element.parentElement.classList.toggle('active');
            }
        };

        /* =============================== */
        /* 4. Language Toggle + Load File   */
        /* =============================== */
        // Gi·∫£ ƒë·ªãnh LANG_EN/LANG_VI ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong file JS t∆∞∆°ng ·ª©ng
        // (N·∫øu kh√¥ng c√≥, c·∫ßn ƒë·∫£m b·∫£o ch√∫ng ƒë∆∞·ª£c t·∫£i l√™n ho·∫∑c ƒë·ªãnh nghƒ©a)

        const langToggle = document.querySelector('.lang-toggle');
        const langText = langToggle.querySelector('span');
        const langFlag = langToggle.querySelector('img');
        let currentLang = "vi"; // Kh·ªüi t·∫°o Ti·∫øng Vi·ªát theo h√¨nh ·∫£nh

        function applyLanguage(langData) {
            const htmlKeys = ['homepage', 'theme', 'logout'];

            for (const key in langData) {
                const elements = document.querySelectorAll(`[data-i18n="${key}"]`);

                elements.forEach(el => {
                    if (htmlKeys.includes(key)) {
                        el.innerHTML = langData[key];
                    } else {
                        el.textContent = langData[key];
                    }
                });
            }
        }

        langToggle.addEventListener('click', () => {
            langToggle.classList.toggle('active');

            if (currentLang === "en") {
                currentLang = "vi";
                langText.textContent = "Ti·∫øng Vi·ªát";
                langFlag.src = "https://flagcdn.com/w40/vn.png";
                if (typeof LANG_VI !== 'undefined') {
                    applyLanguage(LANG_VI);
                }
            } else {
                currentLang = "en";
                langText.textContent = "English";
                langFlag.src = "https://flagcdn.com/w40/gb.png";
                if (typeof LANG_EN !== 'undefined') {
                    applyLanguage(LANG_EN);
                }
            }
        });

        // Kh·ªüi t·∫°o ng√¥n ng·ªØ (Kh·ªüi t·∫°o Ti·∫øng Vi·ªát theo ·∫£nh)
        if (typeof LANG_VI !== 'undefined') {
            applyLanguage(LANG_VI);
        }

        /* =============================== */
        /* 5. Modal Logic (Theme Selector)  */
        /* =============================== */

        const themeButton = document.querySelector('.btn-logout[data-i18n="theme"]');
        const modalBackdrop = document.getElementById('themeModalBackdrop');
        const closeModalButton = document.getElementById('closeThemeModal');
        const themeOptions = document.querySelectorAll('.theme-option');
        const selectedColorDisplay = document.getElementById('selectedColorDisplay');
        const previewStar = document.getElementById('previewStar');

        // H√†m m·ªü Modal
        function openThemeModal() {
            modalBackdrop.classList.add('show');
        }

        // H√†m ƒë√≥ng Modal
        function closeThemeModal() {
            modalBackdrop.classList.remove('show');
        }

        // 5.1. B·∫≠t/T·∫Øt Modal
        themeButton.addEventListener('click', openThemeModal);
        closeModalButton.addEventListener('click', closeThemeModal);

        // ƒê√≥ng Modal khi click ra ngo√†i
        modalBackdrop.addEventListener('click', (e) => {
            if (e.target === modalBackdrop) {
                closeThemeModal();
            }
        });

        // 5.2. Logic ch·ªçn m√†u
        themeOptions.forEach(option => {
            option.addEventListener('click', function() {
                themeOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');

                const selectedColorValue = this.querySelector('i').style.color;

                if (selectedColorDisplay) selectedColorDisplay.style.backgroundColor = selectedColorValue;
                if (previewStar) previewStar.querySelector('i').style.color = selectedColorValue;
            });
        });

        // Kh·ªüi t·∫°o tr·∫°ng th√°i m·∫∑c ƒë·ªãnh (Xanh d∆∞∆°ng)
        const defaultColorValue = themeOptions.length > 1 ? themeOptions[1].querySelector('i').style.color : '#3498db';
        if (selectedColorDisplay) selectedColorDisplay.style.backgroundColor = defaultColorValue;
        if (previewStar) previewStar.querySelector('i').style.color = defaultColorValue;

    });
</script>
{% endblock %}
</body>
</html>